---
title: "Example dashboard with dynamic data from Excel"   # Título del dashboard
output:
  flexdashboard::flex_dashboard:
    orientation: rows                                     # Distribución por filas
    source_code: embed                                    # Botón para ver el código fuente
    theme: yeti                                           # Tema visual (Bootswatch)
runtime: shiny                                            # Backend reactivo con Shiny
---



```{r setup, include=FALSE}
library(tidyverse)                                        # Manipulación de datos
library(flexdashboard)                                    # Componentes del dashboard
library(plotly)                                           # Gráficos interactivos
library(readxl)                                           # Lectura de Excel
library(shiny)                                            # Reactividad

```

```{r get-data, message=FALSE, include=FALSE}
# reactiveFileReader permite que el dashboard se actualice automáticamente
# cuando el archivo Excel cambia y se guarda.
remote_data <- reactiveFileReader(
  intervalMillis = 5000,   # Revisa el archivo cada 5 segundos
  session = NULL,          # Sesión Shiny (NULL = global)
  filePath = "Datos_Ejemplo.xlsx",   # Archivo Excel a vigilar
  readFunc = readxl::read_excel      # Función que lo lee
)
```

## Row

### Categories {.value-box}

```{r}
# valueBox reactivo: se recalcula cuando cambia el Excel
renderValueBox({
  df <- remote_data()                                      # Leer datos actualizados
  n_categories <- df %>% distinct(Category) %>% nrow()     # Nº de categorías únicas
  valueBox(value = n_categories, icon = "fas fa-users")    # Icono: usuarios
})

```

### Total {.value-box}

```{r}
# valueBox reactivo: suma total de Count
renderValueBox({
  df <- remote_data()                                      # Leer datos actualizados
  total <- sum(df$Count)                                   # Suma total
  valueBox(value = total, icon = "fas fa-cubes")           # Icono: cubos
})

```

## Row

###

```{r}
# Gráfico de barras reactivo con Plotly
renderPlotly({
  df <- remote_data()                                      # Datos actualizados
  plot_ly(df,
          x = ~Category,                                   # Eje X
          y = ~Count,                                      # Eje Y
          type = "bar",                                    # Barras
          text = ~paste("Categoría:", Category,            # Texto del hover
                        "<br>Count:", Count),
          hoverinfo = "text")                              # Mostrar solo el texto
})


```
